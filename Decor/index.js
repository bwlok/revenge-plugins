(function(F,i,t,x,A,H,u,D,R,w){"use strict";const fe="https://decor.fieryflames.dev",E=fe+"/api",he=E+"/authorize",ye="https://decorcdn.fieryflames.dev",ge="1096966363416899624",C="100101099111114",G="11497119";function I(e,n){return t.FluxDispatcher.subscribe(e,n),function(){return void t.FluxDispatcher.unsubscribe(e,n)}}const j=i.findByStoreName("UserStore");A.storage.decor_auth||(A.storage.decor_auth={tokens:{}});const O=new Set,h={token:null,tokens:A.storage.decor_auth.tokens??{},init(){const e=j?.getCurrentUser?.();e?.id&&(h.tokens=A.storage.decor_auth.tokens??{},h.token=h.tokens[e.id]??null,V())},setToken(e){const n=j?.getCurrentUser?.();n?.id&&(h.tokens={...h.tokens,[n.id]:e},A.storage.decor_auth.tokens=h.tokens,h.token=e,V())},isAuthorized(){return!!h.token}};function V(){for(const e of O)e()}function Q(e){return O.add(e),function(){return O.delete(e)}}function pe(){const[,e]=t.React.useState(0);return t.React.useEffect(function(){return Q(function(){return e(function(n){return n+1})})},[]),h}const v=pe;v.getState=function(){return h},v.subscribe=Q,h.init();const Re=I("CONNECTION_OPEN",function(){return h.init()}),{pushModal:Se,popModal:W}=i.findByProps("pushModal"),De=i.findByName("OAuth2AuthorizeModal");function Ee(){return Se({key:"oauth2-authorize",modal:{key:"oauth2-authorize",modal:De,animation:"slide-up",shouldPersistUnderModals:!1,props:{clientId:ge,redirectUri:he,scopes:["identify"],responseType:"code",permissions:0n,cancelCompletesFlow:!1,callback:async function({location:e}){const n=new URL(e);n.searchParams.append("client","revenge");const a=await fetch(n);if(a?.ok){const r=await a.text();v.getState().setToken(r)}else W("oauth2-authorize")},dismissOAuthModal:function(){return W("oauth2-authorize")}},closable:!0}})}const ve=t.ReactNative.NativeModules.DCDFileManager??t.ReactNative.NativeModules.RTNFileManager;async function be(e){return e.startsWith("file://")&&(e=e.slice(7)),ve.readFile(e,"base64")}const{View:K}=R.General,Ne=i.findByName("HeaderAvatar"),Ae=i.findByStoreName("UserStore"),Y=t.stylesheet.createThemedStyleSheet({headerAvatarContainer:{display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:D.semanticColors.BACKGROUND_FLOATING,width:208,height:208,borderRadius:4},container:{flexDirection:"row",width:"100%",justifyContent:"center",alignItems:"center",paddingHorizontal:16,paddingTop:16}});function q({pendingAvatarDecoration:e}){return React.createElement(K,{style:Y.container},React.createElement(K,{style:Y.headerAvatarContainer},React.createElement(Ne,{user:Ae.getCurrentUser(),pendingAvatarDecoration:e,size:"editAvatarDecoration",decorationStyle:{margin:-12}})))}async function T(e,n){const a=await fetch(e,{...n,headers:{...n?.headers,Authorization:`Bearer ${v.getState().token}`}});if(a.ok)return a;throw new Error(await a.text())}const Ce=async function(e=void 0){if(e&&e.length===0)return{};const n=new URL(E+"/users");return e&&e.length!==0&&n.searchParams.set("ids",JSON.stringify(e)),await fetch(n).then(function(a){return a.json()})},Ie=async function(e="@me"){return T(E+`/users/${e}/decorations`).then(function(n){return n.json()})},we=async function(e="@me"){return T(E+`/users/${e}/decoration`).then(function(n){return n.json()})},X=async function(e,n="@me"){const a=new FormData;return e&&Object.hasOwn(e,"hash")?(e=e,a.append("hash",e.hash)):e?e&&Object.hasOwn(e,"uri")&&(e=e,a.append("image",{uri:e.uri,type:e.fileType,name:e.fileName}),a.append("alt",e.alt)):a.append("hash",null),T(E+`/users/${n}/decoration`,{method:"PUT",body:a}).then(function(r){return e&&Object.hasOwn(e,"uri")?r.json():r.text()})},Te=async function(e){await T(E+`/decorations/${e}`,{method:"DELETE"})},J=async function(){return fetch(E+"/decorations/presets").then(function(e){return e.json()})};function Z(e){return`${e.animated?"a_":""}${e.hash}`}const Pe=i.findByProps("create","useStore"),{create:ee}=Pe,te=i.findByStoreName("UserStore"),ne=i.findByStoreName("SelectedChannelStore"),b=ee(function(e,n){return{usersDecorations:new Map,fetchQueue:new Set,bulkFetch:t.lodash.debounce(async function(){const{fetchQueue:a,usersDecorations:r}=n();e({fetchQueue:new Set});const s=Array.from(a);if(s.length===0)return;const o=await Ce(s),c=new Map(r);for(const[l,y]of Object.entries(o)){c.set(l,y);const d=te.getUser(l);d&&(d.avatarDecoration=y?{asset:y,skuId:C}:null,d.avatarDecorationData=d.avatarDecoration,t.FluxDispatcher.dispatch({type:"USER_UPDATE",user:d}))}for(const l of s)c.has(l)||c.set(l,null);e({usersDecorations:c})}),async fetch(a,r=!1){const{usersDecorations:s,fetchQueue:o,bulkFetch:c}=n();!r&&s.has(a)||(e({fetchQueue:new Set(o).add(a)}),c())},async fetchMany(a){if(!a.length)return;const{usersDecorations:r,fetchQueue:s,bulkFetch:o}=n(),c=new Set(s);for(const l of a)r.has(l)||c.add(l);e({fetchQueue:c}),o()},get(a){return n().usersDecorations.get(a)},has(a){return n().usersDecorations.has(a)},set(a,r){const{usersDecorations:s}=n(),o=new Map(s);o.set(a,r),e({usersDecorations:o})}}}),_e=[I("LOAD_MESSAGES_SUCCESS",function({messages:e}){b.getState().fetchMany(e.map(function(n){return n.author.id}))}),I("CONNECTION_OPEN",function(){b.getState().fetch(te.getCurrentUser().id,!0)}),I("MESSAGE_CREATE",function(e){const n=ne.getChannelId();e.channelId===n&&b.getState().fetch(e.message.author.id)}),I("TYPING_START",function(e){const n=ne.getChannelId();e.channelId===n&&b.getState().fetch(e.userId)})];function P(e){return{asset:Z(e),skuId:C}}const $e=function(e){return function(n,a,r){const s=r.subscribe;return r.subscribe=function(c,l,y){let d=c;if(l){const f=y?.equalityFn||Object.is;let g=c(r.getState());d=function(k){const p=c(k);if(!f(g,p)){const Lt=g;l(g=p,Lt)}},y?.fireImmediately&&l(g,g)}return s(d)},e(n,a,r)}},Be=i.findByStoreName("UserStore");function Ue(e){const n=Be.getCurrentUser();n.avatarDecoration=e?P(e):null,n.avatarDecorationData=n.avatarDecoration,b.getState().set(n.id,e?Z(e):null),t.FluxDispatcher.dispatch({type:"CURRENT_USER_UPDATE",user:n}),t.FluxDispatcher.dispatch({type:"USER_SETTINGS_ACCOUNT_SUBMIT_SUCCESS"})}const S=ee($e(function(e,n){return{decorations:[],selectedDecoration:null,fetched:!1,fetch:async function(){const a=await Ie(),r=await we();e({decorations:a,selectedDecoration:r,fetched:!0})},create:async function(a){const r=await X(a);e({decorations:[...n().decorations,r]})},delete:async function(a){const r=typeof a=="object"?a.hash:a;await Te(r);const{selectedDecoration:s,decorations:o}=n();let c={decorations:o.filter(function(l){return l.hash!==r})};s?.hash===r&&(c.selectedDecoration=null),e(c)},select:async function(a){e({selectedDecoration:a})},clear:function(){return e({decorations:[],selectedDecoration:null,fetched:!1})}}})),ke=[S.subscribe(function(e){return[e.selectedDecoration,e.fetched]},t.lodash.debounce(function([e,n],[a,r]){n!==r||e?.hash===a?.hash||(X(e),Ue(e))},1e3)),I("CONNECTION_OPEN",function(){return S.getState().clear()})],{FormIcon:Fe}=R.Forms;function _({source:e}){return React.createElement(Fe,{source:e,style:{opacity:1}})}const{ScrollView:xe,View:ae}=t.ReactNative,{FormSection:Oe,FormRow:Le,FormArrow:me,FormInput:Me,FormDivider:ze,FormHint:$}=R.Forms,{popModal:He}=i.findByProps("pushModal"),{launchImageLibrary:Ge}=i.findByProps("launchImageLibrary"),{useSafeAreaInsets:je}=i.findByProps("useSafeAreaInsets"),Ve=i.findByProps("parseTopic"),Qe=t.stylesheet.createThemedStyleSheet({errorHint:{paddingTop:16,color:D.semanticColors.TEXT_DANGER}});function We(){const[e,n]=t.React.useState(null),[a,r]=t.React.useState(""),[s,o]=t.React.useState(!1),[c,l]=t.React.useState(null);t.React.useEffect(function(){c&&l(null)},[e]);const y=je(),d=S(function(f){return f.create});return t.React.createElement(xe,{contentContainerStyle:{flexGrow:1}},t.React.createElement(ae,{style:{flex:1}},t.React.createElement(q,{pendingAvatarDecoration:e?{asset:e?.uri,skuId:G}:null}),c!==null&&t.React.createElement($,{style:Qe.errorHint},c.message),t.React.createElement(Oe,null,t.React.createElement(Le,{label:"Select Image",leading:t.React.createElement(_,{source:u.getAssetIDByName("ic_image")}),trailing:me,onPress:function(){Ge({mediaType:"photo"},function(f){if(!f||f.didCancel){n(null);return}const g=f.assets[0];g&&n(g)})}}),t.React.createElement($,null,"File should be APNG or PNG."),t.React.createElement(ze,null),t.React.createElement(Me,{value:a,onChange:r,placeholder:"Companion Cube",title:"Name"})),t.React.createElement($,null,Ve.parse("Make sure your decoration does not violate [the guidelines](https://github.com/decor-discord/.github/blob/main/GUIDELINES.md) before creating your decoration.",!0,{allowLinks:!0})),t.ReactNative.Platform.OS==="android"&&t.React.createElement($,null,"APNGs will not animate in the preview above on Android.")),t.React.createElement(ae,{style:{justifyContent:"flex-end",paddingHorizontal:16,paddingBottom:y.bottom}},t.React.createElement(R.Button,{text:"Create",color:"brand",size:"medium",onPress:async function(){o(!0);try{let f;t.ReactNative.Platform.OS==="ios"?f="data:"+e.type+";base64,"+await be(e.uri):f=e.uri,await d({uri:f,fileName:e.fileName,fileType:e.type,alt:a}),He("create-decoration"),w.showToast("Decoration created and pending review.",u.getAssetIDByName("Check"))}catch(f){l(f),o(!1)}},loading:s,disabled:!e||!a||e.type!=="image/png"||!!c})))}const Ke=i.findByName("Navigator")??i.findByProps("Navigator")?.Navigator,Ye=i.findByProps("getRenderCloseButton")?.getRenderCloseButton??i.findByProps("getHeaderCloseButton")?.getHeaderCloseButton,{popModal:qe}=i.findByProps("pushModal");function Xe(){return React.createElement(Ke,{initialRouteName:"CREATE_DECORATION",screens:{CREATE_DECORATION:{headerLeft:Ye(function(){return qe("create-decoration")}),render:We,title:"Create Decoration"}}})}const{pushModal:Je}=i.findByProps("pushModal");function Ze(){return Je({key:"create-decoration",modal:{key:"create-decoration",modal:Xe,animation:"slide-up",shouldPersistUnderModals:!1,closable:!0}})}const{View:re,TouchableOpacity:et}=t.ReactNative,{triggerHapticFeedback:tt,HapticFeedbackTypes:nt}=i.findByProps("triggerHapticFeedback"),B=t.stylesheet.createThemedStyleSheet({container:{display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:D.semanticColors.BACKGROUND_FLOATING,width:72,height:72,borderRadius:4},inner:{display:"flex",justifyContent:"space-evenly",alignItems:"center"},selected:{borderWidth:2,borderColor:D.semanticColors.BUTTON_OUTLINE_BRAND_BORDER_ACTIVE},disabled:{opacity:.5}}),ie=function(e,...n){tt(nt.IMPACT_LIGHT),e(...n)};function oe({onPress:e=void 0,onLongPress:n=void 0,disabled:a=void 0,lookDisabled:r=void 0,selected:s=!1,children:o}){return React.createElement(et,{onPress:e?function(...c){return ie(e,...c)}:void 0,onLongPress:n?function(...c){return ie(n,...c)}:void 0,disabled:a},React.createElement(re,{style:[B.container,s?B.selected:null]},React.createElement(re,{style:[B.inner,(a||r)&&B.disabled]},o)))}const{TextStyleSheet:at,Text:rt}=i.findByProps("TextStyleSheet");function L({source:e,label:n,onPress:a,disabled:r,lookDisabled:s=!1,selected:o=!1}){return React.createElement(oe,{onPress:a,disabled:r,lookDisabled:s,selected:o},React.createElement(_,{source:e}),React.createElement(rt,{style:[at["text-sm/medium"]]},n))}const it=i.findByProps("getAvatarDecorationURL","default"),{showSimpleActionSheet:ot}=i.findByProps("showSimpleActionSheet"),{hideActionSheet:st}=i.findByProps("openLazy","hideActionSheet"),ct=i.findByStoreName("UserStore"),{Image:lt}=t.ReactNative;function ut(e){return ot({key:"DecorationActionSheet",header:{title:e.alt??"Decoration",icon:React.createElement(lt,{source:{uri:it.getAvatarDecorationURL({avatarDecoration:P(e)})},style:{width:24,height:24,marginRight:8}}),onClose:function(){return st()}},options:[{icon:u.getAssetIDByName("ic_message_copy"),label:"Copy Decoration Hash",onPress:function(){t.clipboard.setString(e.hash),w.showToast("Copied Decoration Hash!",u.getAssetIDByName("toast_copy_message"))}},...e.authorId===ct.getCurrentUser().id?[{icon:u.getAssetIDByName("ic_message_delete"),label:"Delete",isDestructive:!0,onPress:function(){return H.showConfirmationAlert({title:"Delete Decoration",content:`Are you sure you want to delete ${e.alt??"this decoration"}?`,confirmText:"Delete",cancelText:"Cancel",confirmColor:"red",onConfirm:function(){return t.ReactNative.unstable_batchedUpdates(function(){return S.getState().delete(e)})}})}}]:[]]})}const dt=i.findByName("CutoutableAvatarDecoration");function se({decoration:e,onPress:n=void 0,selectable:a=void 0,disabled:r=void 0}){const s=S(function(l){return l.selectedDecoration}),o=S(function(l){return l.select});a??=e.reviewed===null||e.reviewed===!0,n??=a?function(){return o(e)}:function(){return w.showToast("This decoration has not been approved yet.",u.getAssetIDByName("img_none"))};const c=s?.hash===e.hash;return React.createElement(oe,{onPress:n,onLongPress:function(){return ut(e)},selected:c,disabled:r,lookDisabled:!a},React.createElement(dt,{avatarDecoration:P(e),size:56,animate:c}))}const{FormTitle:ft}=R.Forms,{View:m,FlatList:ht,Image:mt}=t.ReactNative,{TextStyleSheet:yt,Text:gt}=i.findByProps("TextStyleSheet");i.findByName("SummarizedIconRow",!1),i.findByProps("AvatarSizes"),t.stylesheet.createThemedStyleSheet({wrapper:{borderWidth:2,borderRadius:20,borderColor:D.semanticColors.BACKGROUND_SECONDARY,backgroundColor:D.semanticColors.BACKGROUND_SECONDARY}}),i.findByProps("getUser","fetchCurrentUser"),i.findByStoreName("UserStore"),u.getAssetIDByName("default_avatar_0"),u.getAssetIDByName("default_avatar_1"),u.getAssetIDByName("default_avatar_2"),u.getAssetIDByName("default_avatar_3"),u.getAssetIDByName("default_avatar_4"),u.getAssetIDByName("default_avatar_5");function pt({preset:e}){const n=S(function(r){return r.select}),a=t.NavigationNative.useNavigation();return React.createElement(m,null,React.createElement(m,null,React.createElement(ft,{title:e.name}),e.description&&React.createElement(gt,{style:[yt["text-sm/medium"],{paddingHorizontal:16,paddingBottom:8}]},e.description)),React.createElement(ht,{horizontal:!0,showsHorizontalScrollIndicator:!1,data:e.decorations,renderItem:function({item:r}){return React.createElement(se,{decoration:r,onPress:function(){n(r),a.pop()}})},ItemSeparatorComponent:function(){return React.createElement(m,{style:{width:4}})},snapToInterval:74,decelerationRate:"fast",contentContainerStyle:{paddingHorizontal:8}}))}const{View:Rt}=R.General,{FlatList:St}=t.ReactNative;function Dt(){const[e,n]=t.React.useState([]);return t.React.useEffect(function(){J().then(function(a){return n(a)})},[]),t.React.createElement(St,{data:e,renderItem:function({item:a}){return t.React.createElement(pt,{preset:a})},ListFooterComponent:function(){return t.React.createElement(Rt,{style:{height:18}})}})}const{FlatList:Et,View:U,ActivityIndicator:vt,Pressable:bt}=t.ReactNative,{FormTitle:Nt}=R.Forms,{TextStyleSheet:M,Text:z}=i.findByProps("TextStyleSheet"),At=i.findByStoreName("UserStore"),Ct=i.findByProps("parse","parseToAST"),{showUserProfile:ce}=i.findByProps("showUserProfile"),It=i.findByProps("getUser","fetchCurrentUser");function wt(){const[e,n]=t.React.useState(!1),[a,r]=t.React.useState([]),{decorations:s,selectedDecoration:o,fetch:c,clear:l,select:y}=S(),{isAuthorized:d}=v();t.React.useEffect(function(){d()?(J().then(function(p){return r(p)}).catch(function(){}),c().then(function(){return n(!1)}).catch(function(){return n(null)}),n(!0)):(l(),n(!1))},[d]);const f=t.NavigationNative.useNavigation(),g=s.some(function(p){return p.reviewed===!1}),k=a&&o&&a.find(function(p){return p.id===o.presetId});return t.React.createElement(t.React.Fragment,null,t.React.createElement(q,{pendingAvatarDecoration:o?P(o):null}),o&&t.React.createElement(U,{style:{marginTop:12,paddingHorizontal:16,gap:8}},t.React.createElement(z,{style:M["text-lg/semibold"]},o.alt),k&&t.React.createElement(z,{style:M.eyebrow},"Part of the ",k.name," Preset"),t.React.createElement(z,{style:M["text-md/normal"]},"Created by"," ",t.React.createElement(bt,{onPress:function(){return At.getUser(o.authorId)?ce({userId:o.authorId}):It.getUser(o.authorId).then(function(){return ce({userId:o.authorId})})},pointerEvents:"box-only",style:{flexGrow:0,flexShrink:0}},Ct.parse(`<@${o.authorId}>`,!0)))),t.React.createElement(Nt,{title:"Decorations",icon:e?t.React.createElement(vt,null):e===null?t.React.createElement(_,{source:u.getAssetIDByName("ic_warning_24px")}):void 0}),t.React.createElement(Et,{horizontal:!0,showsHorizontalScrollIndicator:!1,data:s,renderItem:function({item:p}){return t.React.createElement(se,{decoration:p,disabled:!d()||e===null})},snapToInterval:74,decelerationRate:"fast",ItemSeparatorComponent:function(){return t.React.createElement(U,{style:{width:4}})},ListHeaderComponent:function(){return t.React.createElement(L,{source:u.getAssetIDByName("img_none"),label:"None",onPress:function(){y(null)},disabled:!d()||e===null,selected:!o})},ListHeaderComponentStyle:{paddingRight:s.length===0?2:4},ListFooterComponent:function(){return t.React.createElement(U,{style:{flexDirection:"row"}},t.React.createElement(L,{source:u.getAssetIDByName("ic_reaction_smile"),label:"Presets",onPress:function(){f.push("VendettaCustomPage",{title:"Presets",render:Dt})},selected:o&&o.presetId!==null,disabled:!d()||e===null}),t.React.createElement(U,{style:{width:4}}),t.React.createElement(L,{source:u.getAssetIDByName("ic_add_24px"),label:"New",onPress:g?function(){return w.showToast("You already have a decoration pending review!",u.getAssetIDByName("img_none"))}:Ze,lookDisabled:g,disabled:!d()||e===null}))},ListFooterComponentStyle:{paddingLeft:s.length===0?2:4},contentContainerStyle:{paddingHorizontal:8}}))}const Tt=t.stylesheet.createThemedStyleSheet({versionText:{fontSize:15,color:D.semanticColors.TEXT_NORMAL,textAlign:"center",fontWeight:"600",lineHeight:22}}),{ScrollView:Pt,View:le}=t.ReactNative,{FormSection:_t,FormRow:$t,FormArrow:Bt,FormSwitchRow:Mt,FormCTAButton:ue,FormDivider:zt,FormInput:Ht,useReducer:Gt}=R.Forms,Ut=R.HelpMessage;function kt(){const{isAuthorized:e}=v();return t.React.createElement(Pt,null,!e()&&t.React.createElement(le,{style:{padding:8}},t.React.createElement(Ut,{messageType:0},"You need to Authorize with Decor before you can get custom decorations.")),t.React.createElement(wt,null),!e()&&t.React.createElement(_t,null,t.React.createElement($t,{label:"Authorize with Decor",leading:t.React.createElement(_,{source:u.getAssetIDByName("ic_link_24px")}),trailing:Bt,onPress:Ee})),e()&&t.React.createElement(ue,{color:"danger",label:"Logout",onPress:function(){return H.showConfirmationAlert({title:"Logout",content:"Are you sure you want to logout?",confirmText:"Logout",confirmColor:"red",cancelText:"Cancel",onConfirm:function(){A.storage.token=void 0,v.getState().setToken(null)}})}}),t.React.createElement(ue,{color:"brand",label:"Source",onPress:function(){return t.ReactNative.Linking.openURL("https://github.com/bwlok/revenge-plugins/tree/master/plugins/Decor")}}),t.React.createElement(t.ReactNative.Text,{style:Tt.versionText},"Decor",`
`,"Version 1.0.1"),t.React.createElement(le,{style:{height:40}}))}const de=i.findByStoreName("UserStore"),Ft=i.findByProps("getAvatarDecorationURL","default"),xt=i.findByProps("isAnimatedAvatarDecoration");i.findByProps("openLazy","hideActionSheet");let N=[];var Ot={onLoad:async function(){N.push(Re),N.push(..._e),N.push(...ke),N.push(x.after("getUser",de,function(e,n){const a=b.getState();if(n&&a.has(n.id)){const r=a.get(n.id);r&&n.avatarDecoration?.skuId!==C?n.avatarDecoration={asset:r,skuId:C}:!r&&n.avatarDecoration&&n.avatarDecoration?.skuId===C&&(n.avatarDecoration=null),n.avatarDecorationData=n.avatarDecoration}})),N.push(x.instead("getAvatarDecorationURL",Ft,function(e,n){const[{avatarDecoration:a,canAnimate:r}]=e;if(a?.skuId===C){const s=a.asset.split("_");return!r&&s[0]==="a"&&s.shift(),ye+`/${s.join("_")}.png`}else return a?.skuId===G?a.asset:n(...e)})),N.push(x.after("isAnimatedAvatarDecoration",xt,function([e],n){if(t.ReactNative.Platform.OS==="ios"&&e?.asset?.startsWith("file://"))return!0})),b.getState().fetch(de.getCurrentUser().id,!0)},onUnload:function(){N.forEach(function(e){return e()})},settings:kt};return F.default=Ot,Object.defineProperty(F,"__esModule",{value:!0}),F})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.plugin,vendetta.ui.alerts,vendetta.ui.assets,vendetta.ui,vendetta.ui.components,vendetta.ui.toasts);
